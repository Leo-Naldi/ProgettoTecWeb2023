openapi: 3.0.3
info:
  title: Squealer Backend API
  description: |-
    Backend API for the Squealer Social Media application.
  contact:
    email: leonard.naldi@studio.unibo.it
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  version: 1.0.0
tags:
  - name: users
    description: Operations dealing with users
  - name: channels
    description: Operations dealing with channels
  - name: messages
    description: Operations dealing with messages
paths:
  /users/{handle}:
    put:
      tags:
        - users
      description: Create a new user with the selected handle
      operationId: createUser
      requestBody:
        description: New user
        required: True
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserInfo'
      parameters:
        - name: handle
          in: path
          description: The new user's Handle
          required: True
          schema: 
            type: string
            example: userHandle123
      responses:
        '200':
          description: User Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'   
        '401':
          description: Unauthorized operation
        '409':
          description: Invalid handle or email
          content:
            application/json:
                schema:
                  type: object
                  properties:
                    message: 
                      type: string
                      enum: 
                        - Invalid Handle
                        - Invalid Email
                        - Invalid Handle and Email
    delete:
      tags:
        - users
      description: Delete the user with the given handle
      operationId: deleteUser
      parameters:
        - name: handle
          in: path
          description: The user's handle
          required: True
          schema: 
            type: string
            example: userHandle123
      responses:
        '200':
          description: User Deleted
        '401':
          description: Unauthorized operation
        '409':
          description: Invalid handle
    get:
      tags:
        - users
      description: G the user with the given handle
      operationId: getUser
      parameters:
        - name: handle
          in: path
          description: The user's handle
          required: True
          schema: 
            type: string
            example: userHandle123
      responses:
        '200':
          description: User found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized operation
        '409':
          description: Invalid handle
    post:
      tags:
        - users
      description: Change user object
      operationId: writeUser
      requestBody:
        description: Data to be modified
        required: True
        content:
          application/json:
            schema:
              anyOf:
                - $ref: '#/components/schemas/UserInfo'
                - $ref: '#/components/schemas/UserTypes'
      parameters:
        - name: handle
          in: path
          description: The user's handle
          required: True
          schema: 
            type: string
            example: userHandle123
      responses:
        '200':
          description: User changed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized operation
        '409':
          description: Invalid handle
          
  /user/{handle}/messages/:
    get:
      tags:
        - users
        - messages
      description: Get all the messages of a specific user
      operationId: getUserMessages
      parameters:
        - name: handle
          in: path
          description: The user's handle
          required: True
          schema: 
            type: string
            example: userHandle123
        - name: channel
          in: query
          description: Channel Filter
          required: False
          schema:
            type: string
            description: The channel name
        - name: from
          in: query
          description: Only get messages from given date onwards
          required: False
          schema:
            type: string
            format: date-time
        - name: to
          in: query
          description: Only get messages up until given date
          required: False
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: User found
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Message'
        '401':
          description: Unauthorized operation
        '409':
          description: Invalid handle
    post:
      tags:
        - users
        - messages
      description: Post new Message
      operationId: postUserMessage
      requestBody:
        description: message to be posted
        required: True
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageInfo'
                
      parameters:
        - name: handle
          in: path
          description: The user's handle
          required: True
          schema: 
            type: string
            example: userHandle123
      responses:
        '200':
          description: Message posted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Message'
        '401':
          description: Unauthorized operation
        '409':
          description: Invalid handle
          
    delete:
      tags:
        - users
        - messages
      description: Delete all messages from the user with the given handle
      operationId: deleteUserMessages
      parameters:
        - name: handle
          in: path
          description: The user's handle
          required: True
          schema: 
            type: string
            example: userHandle123
      responses:
        '200':
          description: Messages Deleted
        '401':
          description: Unauthorized operation
        '409':
          description: Invalid handle
    
  /user/{handle}/messages/{id}:
  
    delete:
      tags:
        - users
        - messages
      description: Delete all messages from the user with the given handle
      operationId: deleteMessage
      parameters:
        - name: handle
          in: path
          description: The user's handle
          required: True
          schema: 
            type: string
            example: userHandle123
        - name: id
          in: path
          description: The message's id
          required: True
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Message Deleted
        '401':
          description: Unauthorized operation
        '409':
          description: Invalid handle
    
components:
  schemas:
    User:
      allOf:
        - $ref: '#/components/schemas/UserHandle'
        - $ref: '#/components/schemas/UserInfo'
        - $ref: '#/components/schemas/UserTypes'
    Message:
      allOf:
        - $ref: '#/components/schemas/MessageInfo'
        - type: object
          required: [viewed, reactions, id]
          properties:
            id:
              type: integer
              format: int64
              description: The message's numerical id
            viewed:
              type: integer
              description: Number of time the message has been viewed
              minimum: 0
            reactions:
              type: object
              required: [positive, negative]
              description: Bookkeeping data on reactions
              properties:
                positive:
                  type: object
                  description: Numbers of positive reactions divided by types
                  properties:
                    agree:
                      type: integer
                      minimum: 0
                    strongAgree: 
                      type: integer
                      minimum: 0
                negative:
                  type: object
                  description: Numbers of negative reactions divided by types
                  properties:
                    disagree:
                      type: integer
                      minimum: 0
                    strongDisagree: 
                      type: integer
                      minimum: 0
                
              
    Channel:
      type: object
      required: [name, created, owner]
      properties:
        name: 
          type: string
          example: AwesomeChannel42
        created:
          type: string
          format: date-time
          description: Channel's creation timestamp
          example: "2021-01-30T08:30:00Z"
        owner:
          type: string
          description: Owner's Handle
        members:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                description: Member's Handle
              joined:
                type: string
                format: date-time
                description: Date of user joining
                example: "2021-01-30T08:30:00Z"
    UserHandle:
      type: object
      properties: 
        handle:
          type: string
          description: User's unique handle
          example: userHandle123
      required: [handle]
    UserInfo:
      type: object
      properties:
        email:
          type: string
          format: email
          example: giovanni@gmail.com
        password:
          type: string
          format: password
          example: supersafepassword123
          minLength: 6
      required: [email, password]
    UserTypes:
      type: object
      properties:
        type:
          type: string
          enum:
            - user
            - pro
            - admin
      required: [type]
    MessageInfo:
      type: object
      required: [content, posted, author, dest]
      properties:
        content:
          type: object
          properties:
            
            text: 
              type: string
              example: This is an example squeal that contains very interesting info.
            image:
              type: string
              format: binary
              description: An image
        posted:
          type: string
          description: Message's timestamp
          format: date-time
          example: "2021-01-30T08:30:00Z"
        author:
          type: string
          description: The author's handle
          example: pieraldo196
        dest:
          type: array
          items:
            type: string
            description: The handle for single individuals, the channel name for channels
          example: ['@gianni', '@alberto', 'CONTROVERSIAL']
    
