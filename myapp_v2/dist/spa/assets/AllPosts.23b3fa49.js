import{Q as Z}from"./QList.97ee5378.js";import{c as $,r as v,k as D,w as S,a as ee,o as te,i as se,b as oe,af as ae,h as Q,e as le,N as re,aH as b,n as M,O as N,aI as B,M as ie,aJ as O,l as ne,g as ce,_ as ue,a5 as U,ak as de,a4 as fe,Y as m,C as ve,D as f,E as k,F as p,aK as me,a9 as P,ai as C,aa as V,ab as q,G as R,H as j,y as ge,ac as F,ae as J,ad as Y,a0 as he,a1 as _e}from"./index.b8bea508.js";import{Q as Se}from"./QPage.0605acda.js";import{S as be}from"./ShowPost.46485ab7.js";import"./use-dark.880f3e4e.js";import"./QItem.ea7b6016.js";import"./ClosePopup.da0077f2.js";import"./focus-manager.05708ea9.js";import"./WritePost.1ecdca4f.js";import"./QInput.c0248187.js";import"./CloseDialog.f0183c26.js";import"./QResizeObserver.231b9bb5.js";import"./QSeparator.92a6cda9.js";import"./QCardActions.f9bcb485.js";import"./QForm.0a780925.js";import"./QCheckbox.952440f4.js";import"./format.3e32b8d9.js";import"./map.c8319187.js";const{passive:g}=re;var ke=$({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:{default:void 0},initialIndex:Number,disable:Boolean,reverse:Boolean},emits:["load"],setup(t,{slots:u,emit:h}){const o=v(!1),a=v(!0),n=v(null),c=v(null);let l=t.initialIndex||0,e,r;const y=D(()=>"q-infinite-scroll__loading"+(o.value===!0?"":" invisible"));function d(){if(t.disable===!0||o.value===!0||a.value===!1)return;const s=b(e),i=N(e),_=O(e);t.reverse===!1?Math.round(i+_+t.offset)>=Math.round(s)&&L():Math.round(i)<=t.offset&&L()}function L(){if(t.disable===!0||o.value===!0||a.value===!1)return;l++,o.value=!0;const s=b(e);h("load",l,i=>{a.value===!0&&(o.value=!1,M(()=>{if(t.reverse===!0){const _=b(e),W=N(e),X=_-s;B(e,W+X)}i===!0?w():n.value&&n.value.closest("body")&&r()}))})}function G(){l=0}function H(){a.value===!1&&(a.value=!0,e.addEventListener("scroll",r,g)),d()}function w(){a.value===!0&&(a.value=!1,o.value=!1,e.removeEventListener("scroll",r,g),r!==void 0&&r.cancel!==void 0&&r.cancel())}function T(){if(e&&a.value===!0&&e.removeEventListener("scroll",r,g),e=ie(n.value,t.scrollTarget),a.value===!0){if(e.addEventListener("scroll",r,g),t.reverse===!0){const s=b(e),i=O(e);B(e,s-i)}d()}}function z(s){l=s}function A(s){s=parseInt(s,10);const i=r;r=s<=0?d:ne(d,isNaN(s)===!0?100:s),e&&a.value===!0&&(i!==void 0&&e.removeEventListener("scroll",i,g),e.addEventListener("scroll",r,g))}function x(s){if(I.value===!0){if(c.value===null){s!==!0&&M(()=>{x(!0)});return}const i=`${o.value===!0?"un":""}pauseAnimations`;Array.from(c.value.getElementsByTagName("svg")).forEach(_=>{_[i]()})}}const I=D(()=>t.disable!==!0&&a.value===!0);S([o,I],()=>{x()}),S(()=>t.disable,s=>{s===!0?w():H()}),S(()=>t.reverse,()=>{o.value===!1&&a.value===!0&&d()}),S(()=>t.scrollTarget,T),S(()=>t.debounce,A);let E=!1;ee(()=>{E!==!1&&e&&B(e,E)}),te(()=>{E=e?N(e):!1}),se(()=>{a.value===!0&&e.removeEventListener("scroll",r,g)}),oe(()=>{A(t.debounce),T(),o.value===!1&&x()});const K=ce();return Object.assign(K.proxy,{poll:()=>{r!==void 0&&r()},trigger:L,stop:w,reset:G,resume:H,setIndex:z}),()=>{const s=ae(u.default,[]);return I.value===!0&&s[t.reverse===!1?"push":"unshift"](Q("div",{ref:c,class:y.value},le(u.loading))),Q("div",{class:"q-infinite-scroll",ref:n},s)}}});const pe={setup(){const t=D(()=>me().getHasClickedShowMore),u=v(!1),h=v([]),o=v(1),a=v(!1),n=U().getUserJson,c=U().user.user!=""||de()!=null;async function l(r,y){const d=c?await m().fetchPosts(n.liked,n.disliked):await m().fetchOfficialPosts();d&&d.length>0?y():a.value=!0}const e=()=>{h.value=h.value.concat(m().getSocketPosts),u.value=!0,m().resetSocketList()};return{router_name:fe().currentRoute.value.name,hasCliked:t,resetSocketList:e,showSocket:u,socket_list:h,counter:o,isDisabled:a,onLoad:l,isLogged:c}},data(){return{notPublic:this.router_name!="Public"}},components:{ShowPost:be},computed:{post_list(){return this.isLogged?m().getPosts:m().getOfficialPosts},socket_post_list(){return m().getSocketPosts}}},Pe=t=>(he("data-v-4634eecc"),t=t(),_e(),t),ye=Pe(()=>j("p",{class:"center"},"You have unread posts!",-1)),Le=[ye],we={class:"row justify-center q-my-md"},xe={key:2};function Ie(t,u,h,o,a,n){const c=ve("ShowPost");return f(),k(Se,{class:"relative-position"},{default:p(()=>[n.socket_post_list.length>0?(f(),P("div",{key:0,class:"tooltip",onClick:u[0]||(u[0]=l=>o.resetSocketList())},Le)):C("",!0),o.showSocket!=!1?(f(),k(Z,{key:1},{default:p(()=>[(f(!0),P(q,null,V(o.socket_list,l=>F((f(),k(c,J({class:"show-post",key:l.id},l,{clickable:""}),null,16)),[[Y,!l.hide]])),128))]),_:1})):C("",!0),R(ke,{onLoad:o.onLoad,offset:250,disable:o.isDisabled},{loading:p(()=>[j("div",we,[R(ge,{color:"primary",name:"dots",size:"40px"})])]),default:p(()=>[(f(!0),P(q,null,V(n.post_list,l=>F((f(),k(c,J({style:{"border-radius":"12px",margin:"0.4rem 0.2rem 0.3rem 0.2rem"},key:l.id},l,{clickable:""}),null,16)),[[Y,!l.hide]])),128))]),_:1},8,["onLoad","disable"]),o.isDisabled?(f(),P("p",xe,"You've loaded all data!")):C("",!0)]),_:1})}var je=ue(pe,[["render",Ie],["__scopeId","data-v-4634eecc"]]);export{je as default};
