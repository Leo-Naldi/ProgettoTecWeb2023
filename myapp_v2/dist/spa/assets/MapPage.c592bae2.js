import{u as d}from"./map.c8319187.js";import{_ as u,Y as i,a4 as l,aF as m,a6 as S,bF as f,bG as c,D as h,a9 as p,ai as g,ab as k,a0 as y,a1 as _,H as w}from"./index.b8bea508.js";const M={data(){return{postStore:i(),router:l(),mapStore:d(),notificationStore:m(),myPos:[44.491,11.352],keywords:"",channels:""}},methods:{drawMap(e,t){this.mapStore.resetMap(),this.mapStore.initializeMapAndLocator(),e.length>0?(this.mapStore.setCenter(e[Math.floor(e.length/2)]),this.mapStore.addMarkersWithPopUp(e,t),this.mapStore.addPolyline(e),this.mapStore.addCustomMarker(this.myPos,"home"),this.mapStore.addLayerMarker(),this.mapStore.addLayerLine()):(this.mapStore.setCenter(this.mapStore.getCurrentLocation()),this.mapStore.addMarkerWithPopUp(this.mapStore.getCurrentLocation(),"home!"),this.mapStore.addLayerMarker())},async fetchSearchResults(e,t){const s=t==1?await this.postStore.searchHashtags(e,!0):await this.postStore.fetchChannelPost(e,!0),{positions:a,popups:r}=s.reduce((n,o)=>(o.content&&o.content.geo&&o.content.geo.coordinates&&n.positions.push(o.content.geo.coordinates),o.content&&n.popups.push(o.content.text),n),{positions:[],popups:[]});a.length<=0?S("The "+e+" has no results with geolocations!"):f("Within "+s.length+" posts, only "+a.length+" of them are with geolocations!"),this.drawMap(a,r)}},computed:{count(){return i().getSocketPost}},watch:{"$route.params":{handler:async function(e){e.keywords&&(this.keywords=e.keywords,this.mapStore.getMap&&(this.mapStore.removeAllMarkers(),this.mapStore.addLayerMarker()),console.log(e),this.fetchSearchResults(e.keywords,1))},immediate:!0},count:{handler:function(e){if(e.content&&e.content.geo&&e.content.geo.coordinates&&e.content.text){const t=/#\w+/,s=e.content.text.match(t);s&&s[0]==="#"+this.keywords&&this.mapStore.addDynamicMarker(e.content.geo.coordinates,e.content.text)}},deep:!0}},async mounted(){c().startNoLoginSocket();const e=this.$route.params;Object.keys(e).length>0&&(e.keywords?(this.keywords=e.keywords,this.fetchSearchResults(this.keywords,1)):e.channels&&(this.channels=e.channels,this.fetchSearchResults(this.channels,2)))},unmounted(){c().startLoggedInSocket()}},P=e=>(y("data-v-97e0ab04"),e=e(),_(),e),x=P(()=>w("div",{id:"MapPage",class:"full-map"},null,-1)),L={key:0,class:"text-center"};function C(e,t,s,a,r,n){return h(),p(k,null,[x,!r.keywords&&!r.channels?(h(),p("p",L,"Please insert a words in inputbar to visualize the map!")):g("",!0)],64)}var R=u(M,[["render",C],["__scopeId","data-v-97e0ab04"]]);export{R as default};
