import{aL as y,aM as le,aN as ue,aO as V,aP as Z,aQ as U,aR as G,aS as j,_ as ce,Y as q,a4 as de,S as L,r as fe,b as me,aT as ge,D as p,E as w,F as m,G as g,aE as ye,aG as I,a7 as P,a8 as b,a9 as F,x as he,ai as T,H as k,Q as x,ac as X,aU as E,a0 as ve,a1 as ke,aV as De,aW as pe}from"./index.b8bea508.js";import{Q as C,a as Me,b as Q}from"./QItem.ea7b6016.js";import{Q as Ne}from"./QList.97ee5378.js";import{Q as we,C as W}from"./ClosePopup.da0077f2.js";import{Q as Te,a as Se,S as be,W as Ie}from"./WritePost.1ecdca4f.js";import{Q as xe}from"./CloseDialog.f0183c26.js";function z(e,t){const n=y(e),a=y(t),s=n.getTime()-a.getTime();return s<0?-1:s>0?1:s}function Ce(e,t){const n=y(e),a=y(t),s=n.getFullYear()-a.getFullYear(),u=n.getMonth()-a.getMonth();return s*12+u}function Re(e,t){return y(e).getTime()-y(t).getTime()}function Pe(e){return e?Math[e]:Math.trunc}function Be(e){const t=y(e);return t.setHours(23,59,59,999),t}function Ue(e){const t=y(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function Qe(e){const t=y(e);return+Be(t)==+Ue(t)}function Ye(e,t){const n=y(e),a=y(t),s=z(n,a),u=Math.abs(Ce(n,a));let d;if(u<1)d=0;else{n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-s*u);let r=z(n,a)===-s;Qe(y(e))&&u===1&&z(e,a)===1&&(r=!1),d=s*(u-Number(r))}return d===0?0:d}function ze(e,t,n){const a=Re(e,t)/1e3;return Pe(n==null?void 0:n.roundingMethod)(a)}function Oe(e,t,n){var c,h;const a=le(),s=(h=(c=n==null?void 0:n.locale)!=null?c:a.locale)!=null?h:ue,u=2520,d=z(e,t);if(isNaN(d))throw new RangeError("Invalid time value");const r=Object.assign({},n,{addSuffix:n==null?void 0:n.addSuffix,comparison:d});let D,l;d>0?(D=y(t),l=y(e)):(D=y(e),l=y(t));const M=ze(l,D),O=(V(l)-V(D))/1e3,f=Math.round((M-O)/60);let v;if(f<2)return n!=null&&n.includeSeconds?M<5?s.formatDistance("lessThanXSeconds",5,r):M<10?s.formatDistance("lessThanXSeconds",10,r):M<20?s.formatDistance("lessThanXSeconds",20,r):M<40?s.formatDistance("halfAMinute",0,r):M<60?s.formatDistance("lessThanXMinutes",1,r):s.formatDistance("xMinutes",1,r):f===0?s.formatDistance("lessThanXMinutes",1,r):s.formatDistance("xMinutes",f,r);if(f<45)return s.formatDistance("xMinutes",f,r);if(f<90)return s.formatDistance("aboutXHours",1,r);if(f<Z){const N=Math.round(f/60);return s.formatDistance("aboutXHours",N,r)}else{if(f<u)return s.formatDistance("xDays",1,r);if(f<U){const N=Math.round(f/Z);return s.formatDistance("xDays",N,r)}else if(f<U*2)return v=Math.round(f/U),s.formatDistance("aboutXMonths",v,r)}if(v=Ye(l,D),v<12){const N=Math.round(f/U);return s.formatDistance("xMonths",N,r)}else{const N=v%12,R=Math.floor(v/12);return N<3?s.formatDistance("aboutXYears",R,r):N<9?s.formatDistance("overXYears",R,r):s.formatDistance("almostXYears",R+1,r)}}function He(e,t){var D;const n=(D=t==null?void 0:t.additionalDigits)!=null?D:2,a=Xe(e);let s;if(a.date){const l=We(a.date,n);s=Ae(l.restDateString,l.year)}if(!s||isNaN(s.getTime()))return new Date(NaN);const u=s.getTime();let d=0,r;if(a.time&&(d=Ve(a.time),isNaN(d)))return new Date(NaN);if(a.timezone){if(r=Ze(a.timezone),isNaN(r))return new Date(NaN)}else{const l=new Date(u+d),M=new Date(0);return M.setFullYear(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()),M.setHours(l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds(),l.getUTCMilliseconds()),M}return new Date(u+d+r)}const Y={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},$e=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Le=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Fe=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Xe(e){const t={},n=e.split(Y.dateTimeDelimiter);let a;if(n.length>2)return t;if(/:/.test(n[0])?a=n[0]:(t.date=n[0],a=n[1],Y.timeZoneDelimiter.test(t.date)&&(t.date=e.split(Y.timeZoneDelimiter)[0],a=e.substr(t.date.length,e.length))),a){const s=Y.timezone.exec(a);s?(t.time=a.replace(s[1],""),t.timezone=s[1]):t.time=a}return t}function We(e,t){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),a=e.match(n);if(!a)return{year:NaN,restDateString:""};const s=a[1]?parseInt(a[1]):null,u=a[2]?parseInt(a[2]):null;return{year:u===null?s:u*100,restDateString:e.slice((a[1]||a[2]).length)}}function Ae(e,t){if(t===null)return new Date(NaN);const n=e.match($e);if(!n)return new Date(NaN);const a=!!n[4],s=B(n[1]),u=B(n[2])-1,d=B(n[3]),r=B(n[4]),D=B(n[5])-1;if(a)return Je(t,r,D)?qe(t,r,D):new Date(NaN);{const l=new Date(0);return!Ge(t,u,d)||!je(t,s)?new Date(NaN):(l.setUTCFullYear(t,u,Math.max(s,d)),l)}}function B(e){return e?parseInt(e):1}function Ve(e){const t=e.match(Le);if(!t)return NaN;const n=A(t[1]),a=A(t[2]),s=A(t[3]);return Ke(n,a,s)?n*G+a*j+s*1e3:NaN}function A(e){return e&&parseFloat(e.replace(",","."))||0}function Ze(e){if(e==="Z")return 0;const t=e.match(Fe);if(!t)return 0;const n=t[1]==="+"?-1:1,a=parseInt(t[2]),s=t[3]&&parseInt(t[3])||0;return _e(a,s)?n*(a*G+s*j):NaN}function qe(e,t,n){const a=new Date(0);a.setUTCFullYear(e,0,4);const s=a.getUTCDay()||7,u=(t-1)*7+n+1-s;return a.setUTCDate(a.getUTCDate()+u),a}const Ee=[31,null,31,30,31,30,31,31,30,31,30,31];function J(e){return e%400===0||e%4===0&&e%100!==0}function Ge(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(Ee[t]||(J(e)?29:28))}function je(e,t){return t>=1&&t<=(J(e)?366:365)}function Je(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function Ke(e,t,n){return e===24?t===0&&n===0:n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}function _e(e,t){return t>=0&&t<=59}const et=e=>(ve("data-v-3628ef4f"),e=e(),ke(),e),tt={key:0},nt={class:"text-grey-7 q-ml-sm"},at={class:"text-grey-7 q-ml-sm"},st=["innerHTML"],it={class:"my-buttons q-mt-sm q-ml-sm text-grey-7"},ot={class:"my-button",id:"dislike"},rt={class:"my-button",id:"like"},lt={key:0},ut={class:"my-button",id:"chart"},ct={key:0,class:"my-button",id:"bookmark"},dt=et(()=>k("span",null,null,-1)),ft={__name:"ShowPost",props:{id:{type:String},_id:{type:String},author:{type:String,default:""},meta:{created:{type:Date,default:NaN},lastModified:{type:Date,defaule:NaN},impressions:{type:Number,default:0}},content:{text:{type:String,default:""},image:{type:String,default:""},video:{type:String,default:""},geo:{type:String,default:"Point",coordinates:{type:Array,default:[]}}},reactions:{positive:{type:Number,default:0},negative:{type:Number,default:0}},answering:{type:String,default:""},canModify:{type:Boolean,default:!1},collected:{type:Boolean,default:!1},hide:{type:Boolean,default:!1},liked:{type:Boolean,default:!1},disliked:{type:Boolean,default:!1},replied:{type:Boolean,default:!1},replies:{type:Array,default:()=>[]},showReply:{type:Boolean,default:!1}},setup(e){const t=e,{hidePost:n,cancelHidePost:a,getReplies:s,getOfficialReplies:u,add_posReaction:d,add_negReaction:r,undo_posReaction:D,undo_negReaction:l,addPositivePublic:M,addNegativePublic:O}=q(),f=de(),v=f.currentRoute.value.name!="Public",c=L({positive:t.reactions.positive,negative:t.reactions.negative}),h=L({liked:t.liked,disliked:t.disliked}),{addToBookmark:N,removeBookmark:R}=q(),K=o=>{f.push({name:"UserDetail",params:{userId:o}})},_=o=>{f.push({name:"PostDetail",params:{postId:o}})},ee=o=>Oe(He(o),new Date),H=fe(t.collected),te=(o,i)=>{o?(H.value=!1,R(i)):(H.value=!0,N(i))},ne=async o=>{let i=null;v?i=await d(o):i=await M(o),i==200&&(h.liked=!0,c.positive+=1)},ae=async o=>{let i=null;v?(i=await D(o),i==200&&(h.liked=!1,c.positive>0?c.positive-=1:c.positive)):(De(o),h.liked=!1,c.positive>0?c.positive-=1:c.positive)},se=async o=>{let i=null;v?i=await r(o):i=await O(o),i==200&&(h.disliked=!0,c.negative+=1)},ie=async o=>{let i=null;v?(i=await l(o),i==200&&(h.disliked=!1,c.negative>0?c.negative-=1:c.negative)):(pe(o),h.disliked=!1,c.negative>0?c.negative-=1:c.negative)};function oe(o){h.liked?ae(o):ne(o)}function re(o){h.disliked?ie(o):se(o)}const $=L({verified:!1,admin:!1,accountType:"user"});return me(async()=>{if(v)try{const o=await ge(t.author);$.verified=o.verified,$.accountType=o.accountType}catch{console.log("\u3010ShowPost\u3011fetchUser to get verified state failed, please see console for more informations!")}}),(o,i)=>(p(),w(Q,{class:"my-posts q-py-md",onClick:i[11]||(i[11]=S=>_(e.id))},{default:m(()=>[g(C,{avatar:"",top:""},{default:m(()=>[g(ye,{color:"lime-6","text-color":"white",size:"xl",onClick:i[0]||(i[0]=I(S=>K(e.author),["stop","prevent"]))},{default:m(()=>[P(b(e.author?e.author[0]+e.author[1]:"Null")+" ",1),$.verified==!0?(p(),F("div",tt,[g(he,{name:"fa-solid fa-circle-check",class:"verified",size:"1rem"})])):T("",!0)]),_:1})]),_:1}),g(C,null,{default:m(()=>[g(Me,{class:"my-post-info text-subtitle1"},{default:m(()=>[k("div",null,[k("strong",null,b(e.author?e.author:"Null"),1),k("span",nt,"@"+b(e.author?e.author:"Null"),1),k("span",at,"\u2022 "+b(ee(e.meta.created))+" ago",1)]),g(x,{flat:"",round:"",color:"grey-5",icon:"more_horiz",onClick:i[5]||(i[5]=I(()=>{},["stop"]))},{default:m(()=>[g(we,null,{default:m(()=>[g(Ne,{style:{"min-width":"100px"}},{default:m(()=>[e.canModify?X((p(),w(Q,{key:0,clickable:"",onClick:i[1]||(i[1]=S=>o.deletePost(e.id))},{default:m(()=>[g(C,{color:"red"},{default:m(()=>[P("delete")]),_:1})]),_:1})),[[W]]):T("",!0),e.canModify?X((p(),w(Q,{key:1,clickable:"",onClick:i[2]||(i[2]=S=>o.modifyPost(e.id))},{default:m(()=>[g(C,null,{default:m(()=>[P("Modify")]),_:1})]),_:1})),[[W]]):T("",!0),e.canModify?T("",!0):X((p(),w(Q,{key:2,clickable:""},{default:m(()=>[e.hide?(p(),w(C,{key:1,onClick:i[4]||(i[4]=S=>E(a)(e.id))},{default:m(()=>[P("Cancel Hide")]),_:1})):(p(),w(C,{key:0,onClick:i[3]||(i[3]=S=>E(n)(e.id))},{default:m(()=>[P("Hide")]),_:1}))]),_:1})),[[W]])]),_:1})]),_:1})]),_:1})]),_:1}),k("div",{class:"post-content",innerHTML:e.content.text},null,8,st),e.content&&e.content.image?(p(),w(Te,{key:0,src:e.content.image,"spinner-color":"white",class:"my-img"},null,8,["src"])):T("",!0),e.content&&e.content.video?(p(),w(Se,{key:1,autoplay:"false",src:e.content.video,ratio:16/9,class:"my-img"},null,8,["src"])):T("",!0),e.content.geo&&e.content.geo.coordinates.length!=0?(p(),w(be,{key:2,mapId:e._id,"my-position":e.content.geo.coordinates},null,8,["mapId","my-position"])):T("",!0),k("div",it,[k("div",ot,[g(x,{flat:"",round:"",color:h.disliked?"black":"grey",icon:h.disliked?"fa-sharp fa-solid fa-thumbs-down":"fa-sharp fa-regular fa-thumbs-down",size:"sm",id:"dislikeBtn",onClick:i[6]||(i[6]=I(S=>re(e.id),["stop","prevent"]))},null,8,["color","icon"]),k("span",null,b(c.negative),1)]),k("div",rt,[g(x,{id:"likeBtn",flat:"",round:"",color:h.liked?"red":"grey",icon:h.liked?"fa-sharp fa-solid fa-thumbs-up":"fa-sharp fa-regular fa-thumbs-up",size:"sm",onClick:i[7]||(i[7]=I(S=>oe(e.id),["stop","prevent"]))},null,8,["color","icon"]),k("span",null,b(c.positive),1)]),k("div",{class:"my-button",id:"reply",onClick:i[8]||(i[8]=I(()=>{},["stop"]))},[g(x,{id:"replyBtn",flat:"",round:"",icon:"fa-regular fa-comment",size:"sm"},{default:m(()=>[!e.showReply&&v?(p(),w(xe,{key:0},{default:m(()=>[g(Ie,{id:e.id,author:e.author},null,8,["id","author"])]),_:1})):T("",!0)]),_:1}),e.showReply?(p(),F("span",lt,b(e.replies.length),1)):T("",!0)]),k("div",ut,[g(x,{id:"chartBtn",flat:"",round:"",icon:"fa-solid fa-chart-simple",size:"sm",onClick:i[9]||(i[9]=I(()=>{},["stop"]))}),k("span",null,b(e.meta.impressions),1)]),v?(p(),F("div",ct,[g(x,{id:"bookmarkBtn",flat:"",round:"",icon:H.value?"fa-solid fa-bookmark":"fa-regular fa-bookmark",size:"sm",onClick:i[10]||(i[10]=I(S=>te(e.collected,e.id),["stop","prevent"]))},null,8,["icon"]),dt])):T("",!0)])]),_:1})]),_:1}))}};var Dt=ce(ft,[["__scopeId","data-v-3628ef4f"]]);export{Dt as S};
